## å®éªŒä¸‰	èšç±»æŠ€æœ¯---å¤æ‚ç½‘ç»œç¤¾å›¢æ£€æµ‹


### ä¸€ã€å®éªŒå†…å®¹

â€‹		å¤æ‚ç½‘ç»œæ˜¯æè¿°å¤æ‚ç³»ç»Ÿçš„æœ‰åŠ›å·¥å…·ï¼Œå…¶ä¸­æ¯ä¸ªå®ä½“å®šä¹‰æˆä¸€ä¸ªèŠ‚ç‚¹ï¼Œ å®ä½“é—´çš„äº¤äº’å…³ç³»å®šä¹‰ä¸ºè¾¹ã€‚å¤æ‚ç½‘ç»œç¤¾å›¢ç»“æ„å®šä¹‰ä¸ºå†…ç´§å¤–æ¾çš„æ‹“æ‰‘ç»“æ„ï¼Œ å³ä¸€ç»„èŠ‚ç‚¹çš„é›†åˆï¼Œé›†åˆå†…çš„èŠ‚ç‚¹äº¤äº’ç´§å¯†ï¼Œä¸å¤–ç•ŒèŠ‚ç‚¹äº¤äº’æ¾æ•£ã€‚

1. å¯¼å…¥karate.gmlä¸­çš„ç©ºæ‰‹é“ç½‘ç»œæ•°æ®ï¼›
2. æ ¹æ®ç½‘ç»œç»“æ„ç‰¹å¾ç»™å‡ºèŠ‚ç‚¹ç›¸ä¼¼æ€§åº¦é‡æŒ‡æ ‡ï¼›
3. é‡‡ç”¨å±‚æ¬¡èšç±»è¿‡ç¨‹å¯¹ç½‘ç»œæ•°æ®è¿›è¡Œèšç±»ï¼›
4. è®¡ç®—æ¨¡å—æ€§æŒ‡æ ‡Qå€¼ï¼Œå½“Qå€¼æœ€å¤§æ—¶è¾“å‡ºèšç±»ç»“æœï¼›
5. é‡‡ç”¨Cytoscapeå·¥å…·ï¼Œå¯è§†åŒ–èšç±»ç»“æœã€‚

### äºŒã€å®éªŒåˆ†æä¸è®¾è®¡

1. å¯¼å…¥karate.gmlä¸­çš„ç©ºæ‰‹é“ç½‘ç»œæ•°æ®ï¼›

   â€‹		åˆ©ç”¨ igraph åº“ä¸­çš„ get_edgelist()å‡½æ•°ï¼Œå–å‡ºæ‰€æœ‰è¾¹çš„åˆ—è¡¨ï¼Œ éå†åˆ—è¡¨è®¡ç®—å‡ºæ•°æ®é›†çš„é‚»æ¥çŸ©é˜µ Aã€‚è‹¥ğ´ğ‘–ğ‘— = 1åˆ™è¡¨ç¤ºæ•°æ®é›†ä¸­ç‚¹ i å’Œç‚¹ j ä¹‹é—´å­˜åœ¨ä¸€æ¡è¾¹

2. æ ¹æ®ç½‘ç»œç»“æ„ç‰¹å¾ç»™å‡ºèŠ‚ç‚¹ç›¸ä¼¼æ€§åº¦é‡æŒ‡æ ‡ï¼›

   â€‹		ç»™å®šèŠ‚ç‚¹ iï¼Œå…¶é‚»å±…èŠ‚ç‚¹å®šä¹‰ä¸ºä¸è¯¥èŠ‚ç‚¹ç›¸è¿æ¥çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆ
   çš„é›†åˆï¼Œå³N(i) = {ğ‘—|ğ´ğ‘–ğ‘— = 1,ğ‘— = 1,2,â€¦ğ‘š}ã€‚ç»™å®šä¸€å¯¹èŠ‚ç‚¹(ğ‘– ï¼Œ ğ‘—)ï¼Œå…¶ ç›¸ä¼¼æ€§å®šä¹‰ä¸ºè¿™ä¸¤ä¸ªèŠ‚ç‚¹çš„å…¬å…±é‚»å±…èŠ‚ç‚¹ä¸é‚»å±…èŠ‚ç‚¹çš„å¹¶çš„æ¯”å€¼ï¼Œå³ï¼š
   $$
   similar_{ij}=\frac{|N(i)\cap N(j)|}{|N(i)\cup N(j)|}
   $$
   å…¶ä¸­ç›¸ä¼¼åº¦åº¦é‡çš„åˆ†å­ä¸ºä¸¤èŠ‚ç‚¹é‚»å±…èŠ‚ç‚¹çš„äº¤é›†ï¼Œåˆ†æ¯ä¸ºä¸¤èŠ‚ç‚¹é‚»å±…èŠ‚ç‚¹çš„å¹¶é›†çš„å…ƒç´ ä¸ªæ•°

3. æ ¹æ®ç›¸ä¼¼åº¦çŸ©é˜µè®¡ç®—ä¸åŒç§ç±»ç¤¾å›¢çš„Qå€¼

   â€‹		å®šä¹‰æ¨¡å—åº¦é‡å€¼ä¸ºï¼š
   $$
   Q_i={\frac{\sum_{i,j\in G}similar_{ij}}{|G|^2}}
   $$

   â€‹		æ˜“çŸ¥å½“èšç±»å†…çš„å„ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ç›¸ä¼¼åº¦è¶Šæ¥è¶Šå°ï¼Œæ•°é‡è¶Šæ¥è¶Šå¤šæ—¶ï¼ŒQå€¼è¶Šæ¥è¶Šå°ï¼Œå½“å°äºæŸä¸€é˜ˆå€¼(**threshold**)æ—¶å°±è¾“å‡ºå½“å‰èšç±»

4. é‡‡ç”¨å±‚æ¬¡èšç±»è¿‡ç¨‹å¯¹ç½‘ç»œæ•°æ®è¿›è¡Œèšç±»ï¼Œè®¡ç®—æ¨¡å—æ€§æŒ‡æ ‡Qå€¼ï¼Œå½“Qå€¼æœ€å¤§æ—¶è¾“å‡ºèšç±»ç»“æœ

   â€‹	èšç±»ç®—æ³•æ­¥éª¤ï¼š

   1. å°†æ‰€æœ‰çš„èŠ‚ç‚¹çœ‹ä½œä¸€ä¸ªå•ç‹¬çš„ç°‡
   2. éå†similarçŸ©é˜µï¼Œå¾—åˆ°ç›¸ä¼¼åº¦æœ€é«˜çš„ä¸¤ä¸ªç°‡
   3. é€‰å–æœ€é«˜ç›¸ä¼¼åº¦ï¼Œæ£€æµ‹æœ€é«˜ç›¸ä¼¼çš„æ˜¯å¦é«˜äºæŸä¸ªé˜ˆå€¼ï¼Œå¦‚æœæ˜¯å°±ç»“æŸèšç±»è¾“å‡ºç»“æœ(æ­¥éª¤5)
   4. å°†ç›¸ä¼¼åº¦æœ€é«˜çš„ä¸¤ä¸ªç°‡åˆå¹¶ï¼Œå¹¶æ›´æ–°similarçŸ©é˜µï¼Œå°†åˆå¹¶çš„ä¸¤ä¸ªç°‡ä¸­çš„æœ€å°çš„similarå€¼æ›´æ–°ä¸ºæ–°çš„ç°‡çš„å€¼(MAXå…¨é“¾)ï¼Œè®°å½•åˆå¹¶çš„ç°‡
   5. è®¡ç®—æ¨¡å—åº¦é‡å€¼Qï¼Œå¦‚æœQå€¼ä½äºè®¾å®šé˜ˆå€¼å°±è¾“å‡ºå½“å‰èšç±»ï¼Œè¿”å›(æ­¥éª¤3)

5. é‡‡ç”¨Cytoscapeå·¥å…·ï¼Œå¯è§†åŒ–èšç±»ç»“æœã€‚

### ä¸‰ã€å…·ä½“å®ç°

1. åˆ©ç”¨ igraph åº“å‡½æ•° get_edgelist()å¯¼å…¥ karate.gml æ•°æ®é›†ï¼Œè®¾ m ä¸ºæ•°æ® é›†ä¸­èŠ‚ç‚¹ä¸ªæ•°ï¼Œn ä¸ºæ•°æ®é›†ä¸­è¾¹çš„æ¡æ•°ã€‚neighbors ä¸ºå„ä¸ªèŠ‚ç‚¹çš„é‚»å±… èŠ‚ç‚¹çš„é›†åˆåˆ—è¡¨ã€‚ä¹‹åè®¡ç®—é‚»æ¥çŸ©é˜µ Aï¼Œè®¾ç½®ä¸¤å±‚ for å¾ªç¯æ¥éå†æ‰€æœ‰ èŠ‚ç‚¹ï¼Œè‹¥ç¬¬ i ä¸ªèŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹ä¸­æœ‰èŠ‚ç‚¹ jï¼Œåˆ™ä»¤A[i, j] = 1ï¼Œä¸”æœ‰ A[j, i] = 1ã€‚

   ```python
   def compute_A():
   
       A = np.zeros((m, m), dtype=np.int)
       for i in range(m):
           for j in range(m):
               if i == j:
                   break
               if j in neighbors[i]:
                   A[i][j] = 1
                   A[j][i] = 1
   
       return A
   ```

   è®¡ç®—çš„å¾—åˆ°çš„é‚»æ¥çŸ©é˜µä¸ºï¼š

![image-20200602150314950](C:\Users\67575\AppData\Roaming\Typora\typora-user-images\image-20200602150314950.png)

2. æ ¹æ®æ•°æ®é›†çš„èŠ‚ç‚¹ä¸ªæ•°mï¼Œå»ºç«‹ä¸€ä¸ªm*må¤§å°çš„çŸ©é˜µå­˜æ”¾ç›¸ä¼¼åº¦ï¼ŒåŒæ—¶ç»´æŠ¤ä¸¤ä¸ª _list P_å’Œ_Q_åˆ†åˆ«å­˜æ”¾èŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹çš„äº¤é›†å’Œå¹¶é›†ï¼Œéå†ä¸¤ä¸ªèŠ‚ç‚¹çš„é‚»å±…èŠ‚ç‚¹ï¼Œå°†å…¶äº¤é›†å’Œå¹¶é›†çš„ç»“æœå­˜æ”¾åˆ° _list P_å’Œ_Q_ä¸­ï¼Œæœ€åå°†ç”±_P_å’Œ_Q_è®¡ç®—å¾—åˆ°çš„ğ‘ ğ‘–ğ‘šğ‘–ğ‘™ğ‘ğ‘Ÿ,åˆ†åˆ«å°†å…¶å­˜æ”¾åˆ°çŸ©é˜µçš„**[i, j]**åŠå…¶å¯¹ç§°ç‚¹**[j, i]**,æ˜¯çš„ç›¸ä¼¼åº¦çŸ©é˜µæˆä¸ºå¯¹ç§°çŸ©é˜µ

   ```python
   def similarity():  # è®¡ç®—ç›¸ä¼¼åº¦
   
       similar = np.zeros((m, m), dtype=np.float)
       for i in range(m):
           for j in range(m):
               p = []
               q = []
               for k in range(m):
   
                   if(i in neighbors[k] and j in neighbors[k]):
                       p.append(k)
                   if(i in neighbors[k] or j in neighbors[k]):
                       q.append(k)
               l1 = len(p)
               l2 = len(q)
               similar[i][j] = l1/l2
               similar[j][i] = l1/l2
       print('similarçŸ©é˜µ:\n', similar)
       return similar
   ```

   ![](C:\Users\67575\AppData\Roaming\Typora\typora-user-images\image-20200602151144389.png)

3. æ ¹æ®ç›¸ä¼¼åº¦çŸ©é˜µè¿›è¡Œå±‚æ¬¡èšç±»,è¿™é‡Œé‡‡ç”¨**å…¨é“¾**èšç±»ï¼Œå…¨é“¾èšç±»æ¯”å•é“¾èšç±»æ›´æ˜¯é€‚åˆäºç°å®é—®é¢˜ï¼Œå¯¹ç¦»ç¾¤ç‚¹å’Œå™ªå£°æ›´ä¸æ•æ„Ÿï¼ŒåŒæ—¶æ›´æ–°ç›¸ä¼¼åº¦çŸ©é˜µï¼Œè¿›è¡Œä¸€æ¬¡åˆ†ç±»ï¼Œè¿”å›åˆå¹¶çš„ä¸¤ä¸ªç°‡x ï¼Œy(è¿™é‡Œçš„x y ä¸ºè¦åˆå¹¶çš„ä¸¤ä¸ªç°‡çš„æŸä¸ªèŠ‚ç‚¹ï¼Œç”¨è¿™ä¸¤ä¸ªèŠ‚ç‚¹æ›´æ–°ç°‡çš„é›†åˆ)

   ```python
   # ----------------------å±‚æ¬¡èšç±»å‡½æ•°--------------------------------------# 
   def cluster(sim):
       m = len(sim)
       max_s = 0
       x = 0
       y = 0
       # é€‰å‡ºæœ€å¤§ç›¸ä¼¼åº¦
       for i in range(m):
           for j in range(m):
               if(sim[i][j] > max_s):
                   x = i
                   y = j
                   max_s = sim[i][j]
       # å…¨é“¾ç®—æ³•æ›´æ–°ç›¸ä¼¼åº¦çŸ©é˜µ
       for i in range(m):
           sim[x][i] = min(sim[x][i], sim[y][i])
           sim[y][i] = min(sim[x][i], sim[y][i])
       return x, y	
   ```

4. è®¡ç®—æ¨¡å—åŒ–é‡å€¼Qå¹¶ä¸é˜ˆå€¼è¿›è¡Œæ¯”è¾ƒï¼Œè¾“å‡ºå®Œæˆèšç±»çš„ç°‡,è®¾åˆ†ç±»æ ‡ç­¾_clusters_ä¸ºä¸€ç»´Listï¼Œclusters[i]çš„å€¼è¡¨ç¤ºèŠ‚ç‚¹__i__å±äºç°‡__clusters[i]__,åˆå§‹å°†clustersç½®ä¸º-1ï¼Œè¡¨ç¤ºæ‰€æœ‰çš„ç‚¹éƒ½æœªåˆ†ç±»

   åŒæ—¶å¯¹äºæ¨¡å—åŒ–é‡å€¼Qçš„è®¡ç®—ï¼Œåˆ©ç”¨sum_clusterå’Œcounter è¿›è¡Œè®¡ç®—

   ```python
   # -------------------------æ¨¡å—åŒ–åº¦é‡å€¼----------------------------------#
   def init_compute_clusters(clusters, m):  # åˆå§‹åŒ–clustersåˆ—è¡¨ï¼Œå°†clustersçš„æ¯ä¸€ä½ç½®ä¸º-1ï¼Œè¡¨ç¤ºæœªåˆ†ç±»
       for i in range(m):
           clusters.append(-1)
       return clusters
   
   
   # æ¨¡å—åº¦Qè®¡é‡
   def compute_Q(f, cluster_class, similar):
       if cluster_class == -1:		#å¦‚æœç°‡ä¸ºæœªåˆ†ç±»ï¼Œè¿”å›ä¸€ä¸ªæœ€å¤§å€¼MAX=10000
           return 10000
       sum_similar = 0
       count_similar = 0
       for i in range(M):
           for j in range(M):
               if f[i] == cluster_class:
                   sum_similar += similar[i][j]	# å¦‚æœèŠ‚ç‚¹iä½äºç°‡å†…ï¼Œåˆ™è®¡ç®—èŠ‚ç‚¹iä¸å…¶ä»–å„èŠ‚ç‚¹çš„ç›¸ä¼¼åº¦ï¼ŒåŒæ—¶æ›´æ–°ç°‡å†…èŠ‚ç‚¹æ•°é‡count_cluster
                   count_similar += 1
       Q = sum_similar/(count_similar*count_similar)	# è®¡ç®—Qå€¼
       # print("cluster class is ", cluster_class, "Q is ", Q)
       return Q
   ```

5. å¦‚æœæŸä¸ªç°‡çš„æ¨¡å—åŒ–åº¦é‡å€¼å°äºé˜ˆå€¼ï¼Œåˆ™å°†è¿™ä¸ªç°‡å†…çš„å„ä¸ªèŠ‚ç‚¹ä¸å…¶ä»–èŠ‚ç‚¹çš„ç›¸ä¼¼åº¦ç½®0ï¼Œæ¥ä¿å­˜å½“å‰ç°‡çš„åˆ†ç±»ç»“æœä¸å†æ›´æ–°ï¼ŒåŒæ—¶ç»§ç»­æ›´æ–°å…¶ä»–çš„ç°‡èšç±»

   ```python
   # --------------------------å°†Qå€¼ä½äºé˜ˆå€¼çš„åˆ†ç±»å­˜å‚¨---------------------#
   def save_cluster(cluster_class, clusters, similar):
       for i in range(M):
           if clusters[i] == cluster_class:
               for j in range(M):
                   similar[i][j] = 0
   ```

6. ä¸»å‡½æ•°è´Ÿè´£å®šä¹‰åˆå§‹å˜é‡åŠå¯¹èšç±»å‡½æ•°è¿”å›çš„x ï¼Œy å€¼è¿›è¡Œèšç±»æ›´æ–°åŠclustersèšç±»æ ‡ç­¾çš„æ›´æ–°

   ```python
   # -------------------------ä¸»å‡½æ•°-----------------------------------#
   A = compute_A(M)
   similar = similarity(M)
   clusters = []
   cluster_complete = []
   clusters = init_compute_clusters(clusters, M)
   i = 0
   flag = 0
   threshold = 0.00008     # é˜ˆå€¼å®šä¹‰ï¼Œå°äºé˜ˆå€¼å³è®¤ä¸ºæ¨¡å—åŒ–ç¨‹åº¦è¿‡ä½ä¸æ˜“ç»§ç»­èšç±»ï¼Œè¿™é‡Œé‡‡ 0.00008
   Q = 100000
   while(i < 100):
       x, y = cluster(similar)
       if clusters[x] != -1 and clusters[y] != -1:		# x,yéƒ½å·²ç»åˆ†ç±»ï¼Œåˆ™å°†x,yçš„èšç±»åˆå¹¶æˆä¸ºä¸€ä¸ªï¼Œè¿™é‡Œé‡‡ç”¨åˆå¹¶æ ‘çš„æ€æƒ³ï¼Œå°†ç›¸åŒç°‡çš„èŠ‚ç‚¹éå†å¹¶è¿›è¡Œä¿®æ”¹
           temp = clusters[y]
           for j in range(M):
               if clusters[j] == temp:
                   clusters[j] = clusters[x]
       if clusters[x] == -1 or clusters[y] == -1:	# ä¸¤ä¸ªç°‡ä¸­è‡³å°‘æœ‰ä¸€ä¸ªæœªåˆ†ç±»
           if clusters[x] == -1 and clusters[y] == -1:	#ä¸¤ä¸ªç°‡éƒ½æœªåˆ†ç±»
               flag += 1
               clusters[x] = clusters[y] = flag	# æ–°å»ºä¸€ä¸ªåˆ†ç±»ä¿å­˜æ­¤ç°‡
           elif clusters[x] == -1:					# xæœªåˆ†ç±»yå·²åˆ†ç±»ï¼Œå°†xå¹¶åˆ°yä¸Šå»
               clusters[x] = clusters[y]
           elif clusters[y] == -1:					# xå·²åˆ†ç±»yæœªåˆ†ç±»ï¼Œå°†yå¹¶åˆ°xä¸Šå»
               clusters[y] = clusters[x]
       Q = compute_Q(clusters, clusters[x], similar)	# è®¡ç®—Q
       if Q < threshold:		# å¦‚æœQå¤§äºæŸé˜ˆå€¼åˆ™è¾“å‡ºå½“å‰åˆ†ç±»ç°‡
           cluster_complete = save_cluster(clusters[x], clusters, similar)
       i += 1
   print(clusters)
   print(Q)
   outputData(clusters, edgelist)
   ```

7. è¾“å‡ºå‡½æ•°ï¼Œå°†åˆ†ç±»ä¸æ— å‘å›¾åˆ†åˆ«ä¿å­˜åœ¨graph.csvå’Œclass.csvå¹¶è¾“å‡º

   ```PYTHON
   def outputData(clusters,  edges):   # è¾“å‡ºæ— å‘å›¾çš„è¿æ¥å…³ç³»ï¼Œè¾“å‡ºåˆ†ç±»ç»“æœ
       edge_out = []
       graph_file = data_source+'grafh.csv'
       name1 = ['nodea',  'edgetype',  'nodeb']
       for edge in edges:
           edge_out.append((edge[0]+1, 1, edge[1]+1))
       out1 = pd.DataFrame(columns=name1, data=edge_out)
       out1.to_csv(graph_file)
   
       attribute_file = data_source+'class.csv'
       name2 = ['node',  'class']
       attribute_out = []
       for i in range(1, M+1):
           attribute_out.append((i, clusters[i-1]))
       out2 = pd.DataFrame(columns=name2,  data=attribute_out)
       out2.to_csv(attribute_file)
   ```



## å››ã€å®éªŒç»“æœ

æœªåˆ†ç±»å‰çš„karateèŠ‚ç‚¹æ•°æ®ï¼š

![karate](C:\Users\67575\Desktop\HomeWork\datamining\èšç±»æŠ€æœ¯---å¤æ‚ç½‘ç»œç¤¾å›¢æ£€æµ‹ä»£ç \data\karate.png)

æœ€ç»ˆåˆ†ç±»ç»“æœï¼š

[9, 9, 9, 9, 4, 4, 4, 9, 5, 5, 4, 9, 9, 9, 5, 5, 4, 9, 5, 9, 5, 9, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5]

![image-20200603173024704](C:\Users\67575\AppData\Roaming\Typora\typora-user-images\image-20200603173024704.png)

åˆ†ç±»åçš„ç°‡(ä½¿ç”¨cytoscapeè¿›è¡Œå¯è§†åŒ–)

![grafh_me](C:\Users\67575\Desktop\HomeWork\datamining\èšç±»æŠ€æœ¯---å¤æ‚ç½‘ç»œç¤¾å›¢æ£€æµ‹ä»£ç \data\grafh_me.png)

## äº”ã€å®éªŒæ€»ç»“

â€‹	ç»è¿‡æœ¬æ¬¡å®éªŒæˆ‘åˆæ­¥ç†è§£äº†åŸºæœ¬çš„å±‚æ¬¡èšç±»æŠ€æœ¯åŠå…¶åº”ç”¨ï¼Œæ›´å¥½çš„æŒæ¡äº†æ•°æ®æŒ–æ˜çš„ç›¸å…³çŸ¥è¯†ä¸æ¨¡å‹ï¼Œä»£ç å®ç°è¾ƒå®éªŒä¸€è¾ƒä¸ºç®€å•ï¼Œè¾ƒå¥½çš„åº”ç”¨äº†å·²å­¦çŸ¥è¯†ï¼Œæ›´å¥½çš„ç†è§£äº†æœ¬å­¦ä¹ å­¦ä¹ çš„ç†è®ºçŸ¥è¯†çš„åº”ç”¨ï¼ŒåŒæ—¶æœ‰æœºä¼šåº”ç”¨äº† igraph åº“å’Œ pandas åº“ç­‰å¾ˆç®€æ´å¥½ç”¨çš„åº“å‡½æ•°ï¼Œè¿™å¤§å¤§ç®€åŒ–äº†æˆ‘çš„å®éªŒè¿‡ç¨‹ã€‚å¯¹äºåˆ†ç±»ç»“æœæˆ‘ä¸ªäººè®¤ä¸ºç¬¦åˆæˆ‘çš„é¢„æœŸï¼Œä½†åœ¨å®šä¹‰æ¨¡å—åŒ–é‡å€¼Qæ—¶é‡åˆ°äº†å¾ˆå¤šå›°éš¾ï¼Œæœ€ååœ¨ä¸å…¶ä»–åŒå­¦äº¤æµä¸ç½‘ç»œæŸ¥è¯¢ä¸­åŸºæœ¬è§£å†³ï¼Œå¸Œæœ›åœ¨ä»¥åçš„å®éªŒä¸­å¯ä»¥åšçš„æ›´å¥½



